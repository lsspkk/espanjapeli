================================================================================
ESPANJAPELI V4.0.0 - TASK LIST
================================================================================

Project: Data-First Architecture + Story Mode Excellence
Timeline: 8 weeks (16-24 coding sessions)
Task Size: 4-6 hours per task
Principle: Simple, maintainable, one-developer-friendly

================================================================================
PRIORITY 1: DATA FOUNDATION (Tasks 1-4)
================================================================================
These tasks MUST be completed first. The datamodel is the foundation.
All subsequent features depend on getting this right.


================================================================================
TASK 1: Download and Process Open-Source Frequency Datasets
================================================================================

DESCRIPTION:
Download Spanish and Finnish frequency data from OpenSubtitles (CC-BY-SA-4.0).
Create simple Python scripts that fetch the data and convert to JSON format
suitable for bundling as static files. IMPORTANT: Filter to top 5000 words only
to keep bundle size reasonable (~1MB vs 10MB). This is the foundation for all
vocabulary features.

OBJECTIVES:
â€¢ Download Spanish 50k frequency list from hermitdave/FrequencyWords
â€¢ Download Finnish 50k frequency list for reference
â€¢ Parse text format into structured JSON
â€¢ FILTER to top 5000 words only (sufficient for B2 level)
â€¢ Add CEFR level estimates based on frequency rank
â€¢ Create top100, top500, top1000, top3000 boolean flags
â€¢ Split output into tiered files for lazy loading
â€¢ Create data size measurement report
â€¢ Output as static JSON files for the svelte app

DELIVERABLES:
â–¡ scripts/data_pipeline/download_frequency.py
â–¡ svelte/static/data/frequency-spanish-top1000.json (~200KB)
â–¡ svelte/static/data/frequency-spanish-top5000.json (~1MB)
â–¡ svelte/static/data/frequency-finnish-top5000.json (reference, ~1MB)
â–¡ scripts/data_pipeline/measure_data_size.py (reports file sizes)
â–¡ README in scripts/data_pipeline/ explaining filtering rationale

DATA SOURCE:
- URL: https://raw.githubusercontent.com/hermitdave/FrequencyWords/master/content/2018/es/es_50k.txt
- License: CC-BY-SA-4.0 (must attribute in app)
- Format: "word count" per line, already sorted by frequency

OUTPUT FORMAT (split files):

frequency-spanish-top1000.json (~200KB):
{
  "version": "1.0.0",
  "source": "OpenSubtitles 2018",
  "license": "CC-BY-SA-4.0",
  "wordCount": 1000,
  "range": "1-1000",
  "words": {
    "de": { "rank": 1, "cefr": "A1", "top100": true, "top500": true, "top1000": true },
    "que": { "rank": 2, "cefr": "A1", "top100": true, "top500": true, "top1000": true },
    ...
  }
}

frequency-spanish-top5000.json (~1MB):
{
  "version": "1.0.0",
  "source": "OpenSubtitles 2018",
  "license": "CC-BY-SA-4.0",
  "wordCount": 5000,
  "range": "1-5000",
  "words": { /* all 5000 words */ }
}

DATA SIZE RATIONALE:
- Full 50k words: 10.6 MB (too large for initial load)
- Top 5k words: ~1 MB (reasonable, covers A1-B2)
- Top 1k words: ~200 KB (instant load for beginners)
- With gzip: 70% reduction (300KB for top 5k)
- Coverage: Top 5000 words = ~95% of spoken Spanish

FILTERING STRATEGY:
1. Download full 50k list
2. Keep only top 5000 (rank 1-5000)
3. Generate separate top 1000 file for lightweight lookups
4. Discard ranks 5001-50000 (rare words not needed for A1-B2 learners)

MEASUREMENT SCRIPT:
```python
# scripts/data_pipeline/measure_data_size.py
import json
import gzip
from pathlib import Path

def measure_json_size(filepath: Path):
    """Measure raw and gzipped JSON size."""
    raw_size = filepath.stat().st_size
    
    with open(filepath, 'rb') as f_in:
        with gzip.open(filepath.with_suffix('.json.gz'), 'wb') as f_out:
            f_out.writelines(f_in)
    
    gzip_size = filepath.with_suffix('.json.gz').stat().st_size
    
    print(f"{filepath.name}:")
    print(f"  Raw:    {raw_size:>10,} bytes ({raw_size/1024/1024:.2f} MB)")
    print(f"  Gzipped: {gzip_size:>10,} bytes ({gzip_size/1024/1024:.2f} MB)")
    print(f"  Compression: {100*(1-gzip_size/raw_size):.1f}%")
    
    # Load and report word count
    with open(filepath) as f:
        data = json.load(f)
        print(f"  Words:   {data.get('wordCount', len(data.get('words', {})))} entries")
    print()

# Run on all generated files
for file in Path('svelte/static/data').glob('frequency-*.json'):
    measure_json_size(file)
```

EXPECTED OUTPUT:
frequency-spanish-top1000.json:
  Raw:         200,000 bytes (0.19 MB)
  Gzipped:      60,000 bytes (0.06 MB)
  Compression: 70.0%
  Words:       1000 entries

frequency-spanish-top5000.json:
  Raw:       1,000,000 bytes (0.95 MB)
  Gzipped:     300,000 bytes (0.29 MB)
  Compression: 70.0%
  Words:       5000 entries

CEFR ESTIMATION:
- Rank 1-500: A1
- Rank 501-1500: A2
- Rank 1501-3000: B1
- Rank 3001-5000: B2
- Rank 5001+: C1/C2 (not included - beyond scope)

WEB SERVER CONFIGURATION NOTE:
Ensure gzip compression enabled in nginx/apache/node:
- Compresses JSON by ~70%
- 1MB file â†’ 300KB over wire
- No client-side changes needed

ESTIMATED TIME: 4-5 hours (including measurement script)


================================================================================
TASK 2: Enhance Existing words.ts with Frequency and Metadata
================================================================================

DESCRIPTION:
Update the existing words.ts vocabulary database to include frequency ranks,
CEFR levels, and part-of-speech information. Match existing words against the
downloaded frequency data. Keep it simple - extend the existing Word interface
with optional fields for backward compatibility.

OBJECTIVES:
â€¢ Extend Word interface with new optional fields
â€¢ Create script to match words.ts entries with frequency data
â€¢ Add id field to each word (for cross-referencing)
â€¢ Add partOfSpeech field (noun, verb, adjective, etc.)
â€¢ Add gender field for nouns (masculine, feminine)
â€¢ Add frequencyRank from downloaded data
â€¢ Add cefrLevel based on frequency

CURRENT INTERFACE (words.ts):
interface Word {
  spanish: string;
  english: string;
  finnish: string;
  learningTips?: string[];
}

ENHANCED INTERFACE:
interface Word {
  // Existing
  spanish: string;
  english: string;
  finnish: string;
  learningTips?: string[];
  
  // NEW (all optional for gradual migration)
  id?: string;                    // "perro", "banco_n", "banco_v"
  frequencyRank?: number;         // 847
  cefrLevel?: string;             // "A1"
  partOfSpeech?: string;          // "noun"
  gender?: string;                // "masculine"
}

WORD ID GENERATION (Python pseudocode):
The ID should be human-readable and derived from the Spanish word itself.
No external library needed - just normalize the word to ASCII slug.

```python
import re
import unicodedata

def spanish_to_id(word: str, pos: str = None) -> str:
    """Convert Spanish word to stable, URL-safe ID."""
    # 1. Normalize unicode: Ã¡â†’a, Ã±â†’n, Ã¼â†’u
    normalized = unicodedata.normalize('NFKD', word.lower())
    ascii_text = normalized.encode('ascii', 'ignore').decode('ascii')
    
    # 2. Replace non-alphanumeric with underscore
    slug = re.sub(r'[^a-z0-9]+', '_', ascii_text).strip('_')
    
    # 3. For homonyms, append part-of-speech suffix
    if pos:
        suffix = {'noun': 'n', 'verb': 'v', 'adjective': 'a', 
                  'adverb': 'adv', 'preposition': 'prep'}
        slug = f"{slug}_{suffix.get(pos, pos[:1])}"
    
    return slug

# Examples:
# ("perro", None)     â†’ "perro"
# ("niÃ±o", None)      â†’ "nino"
# ("Â¿CÃ³mo estÃ¡s?")    â†’ "como_estas"
# ("banco", "noun")   â†’ "banco_n"      (bank/bench)
# ("banco", "verb")   â†’ "banco_v"      (I bank)
```

COLLISION HANDLING:
Collisions occur when same Spanish word has multiple meanings (homonyms).

Strategy 1 - Part of Speech Suffix (preferred):
  - If word has different meanings for different parts of speech, append suffix
  - "banco" (noun: bank) â†’ "banco_n"
  - "banco" (verb: I bank) â†’ "banco_v"
  - This is how WordNet handles it: dog.n.01

Strategy 2 - Numeric Suffix (fallback for same-POS homonyms):
  - If same word, same POS, different meanings â†’ append number
  - "banco_n" (bank building) â†’ "banco_n_1"
  - "banco_n" (bench) â†’ "banco_n_2"
  - Keep a counter per base slug during data generation

Implementation in enrich_words.py:
```python
seen_ids = {}  # Track used IDs

def generate_unique_id(word: str, pos: str = None) -> str:
    base_id = spanish_to_id(word, pos)
    
    if base_id not in seen_ids:
        seen_ids[base_id] = 1
        return base_id
    
    # Collision! Add numeric suffix
    seen_ids[base_id] += 1
    return f"{base_id}_{seen_ids[base_id]}"

# Usage:
# First "banco" noun  â†’ "banco_n"
# Second "banco" noun â†’ "banco_n_2"
```

PRACTICAL NOTES:
- For Espanjapeli's curated ~500 word vocabulary, collisions are rare
- Most homonyms are already different POS (banco noun vs verb)
- If collision detected during data pipeline, script should log warning
- Human review recommended for homonym cases to ensure correct meaning

DELIVERABLES:
â–¡ Updated svelte/src/lib/data/words.ts with new interface
â–¡ scripts/data_pipeline/enrich_words.py - matches words to frequency
â–¡ All ~500 existing words tagged with frequency rank
â–¡ Part of speech for all words (manual review needed)
â–¡ Gender for all nouns

APPROACH:
- Script reads words.ts, looks up each spanish word in frequency JSON
- Outputs enriched words.ts with new fields
- Manual review for part-of-speech (can be done incrementally)

ESTIMATED TIME: 5-6 hours


================================================================================
TASK 3: Create Vocabulary Service and Statistics Calculation
================================================================================

DESCRIPTION:
Create a simple vocabulary service that loads frequency data and provides
lookup functions. Create statistics calculation that tells user their progress
on learning the most common words. Store user's vocabulary knowledge in
localStorage with efficient format.

OBJECTIVES:
â€¢ Create vocabularyService.ts for frequency lookups
â€¢ Create statisticsService.ts for progress calculations
â€¢ Load frequency JSON on first use (lazy loading)
â€¢ Calculate: "You know X of top 1000 words"
â€¢ Calculate estimated CEFR level
â€¢ Track words learned over time
â€¢ Simple localStorage format for progress

DELIVERABLES:
â–¡ svelte/src/lib/services/vocabularyService.ts
â–¡ svelte/src/lib/services/statisticsService.ts
â–¡ VocabularyStatistics type definition
â–¡ Integration with existing wordKnowledge store

KEY FUNCTIONS:
// vocabularyService.ts
getFrequencyRank(spanish: string): number
getCEFRLevel(spanish: string): string
isInTopN(spanish: string, n: number): boolean
getWordMetadata(spanish: string): WordMetadata

// statisticsService.ts
calculateVocabularyStats(): VocabularyStatistics
getTop100Progress(): { known: number, total: 100 }
getTop500Progress(): { known: number, total: 500 }
getTop1000Progress(): { known: number, total: 1000 }
getEstimatedLevel(): "A1" | "A2" | "B1" | "B2"

STORAGE FORMAT (efficient for localStorage):
- Don't store huge objects
- Store word IDs with scores, not full word data
- Keep last 100 game records max
- Compress timestamps to epoch seconds

ESTIMATED TIME: 4-5 hours


================================================================================
TASK 4: Create Licenses Page and Data Attribution
================================================================================

DESCRIPTION:
Create a proper licenses/about page that shows all data sources, their licenses,
and required attributions. This is legally required for CC-BY-SA and CC-BY
licensed data. Also show software licenses (SvelteKit, DaisyUI, etc.).

OBJECTIVES:
â€¢ Create /tietoja (About) route in SvelteKit
â€¢ List all data sources with proper attribution
â€¢ Show software licenses used
â€¢ Create simple, readable layout
â€¢ Add to future navbar (placeholder link for now)

DATA SOURCES TO ATTRIBUTE:
1. OpenSubtitles Frequency Data
   - Source: hermitdave/FrequencyWords
   - License: CC-BY-SA-4.0
   - Attribution: "Frequency data from OpenSubtitles via FrequencyWords"

2. (Future) Tatoeba Sentences
   - License: CC-BY
   - Attribution: "Example sentences from Tatoeba.org"

3. (Future) Wiktionary Data
   - License: CC-BY-SA-3.0
   - Attribution: "Dictionary data from Wiktionary"

SOFTWARE LICENSES:
- SvelteKit: MIT
- DaisyUI: MIT
- Tailwind CSS: MIT
- (List all from package.json)

DELIVERABLES:
â–¡ svelte/src/routes/tietoja/+page.svelte
â–¡ License data JSON or TypeScript file
â–¡ Clean, readable UI for viewing licenses
â–¡ Links to original sources

ESTIMATED TIME: 3-4 hours


================================================================================
PRIORITY 2: NAVIGATION AND STRUCTURE (Tasks 5-6)
================================================================================


================================================================================
TASK 5: Implement Navigation Bar and App Menu
================================================================================

DESCRIPTION:
Create a navigation bar using DaisyUI components. This provides consistent
navigation across all pages. Mobile-friendly with hamburger menu. Simple
implementation that can be extended later.

OBJECTIVES:
â€¢ Create Navbar.svelte component with DaisyUI
â€¢ Desktop: horizontal menu with visible links
â€¢ Mobile: hamburger menu (drawer or dropdown)
â€¢ Add links: Koti, Tarinat, Pelit, Asetukset, Tietoja
â€¢ Integrate into +layout.svelte
â€¢ Highlight current page

MENU ITEMS:
- Koti (Home) â†’ /
- Tarinat (Stories) â†’ /tarinat
- Pelit (Games) â†’ / (existing games section)
- Sanasto (Vocabulary) â†’ /sanasto (future statistics page)
- Asetukset (Settings) â†’ /asetukset
- Tietoja (About/Licenses) â†’ /tietoja

DELIVERABLES:
â–¡ svelte/src/lib/components/shared/Navbar.svelte
â–¡ Updated svelte/src/routes/+layout.svelte
â–¡ Mobile hamburger menu implementation
â–¡ Active page highlighting
â–¡ Responsive design

TECHNICAL APPROACH:
- Use DaisyUI navbar component
- Use DaisyUI drawer for mobile menu
- Keep it simple - no complex state
- CSS-only hamburger toggle if possible

ESTIMATED TIME: 4-5 hours


================================================================================
TASK 6: Create Settings Page and User Preferences
================================================================================

DESCRIPTION:
Create a settings page for user preferences. Include TTS settings, theme
selection, and data management (export/import). Keep simple, store in
localStorage.

OBJECTIVES:
â€¢ Create /asetukset route
â€¢ TTS settings: speed, voice selection
â€¢ Theme selection (existing themes)
â€¢ Data export: download progress as JSON
â€¢ Data import: restore from JSON file
â€¢ Reset progress option (with confirmation)

SETTINGS TO INCLUDE:
1. TTS Settings
   - Playback speed (0.75x, 1x, 1.25x, 1.5x)
   - Voice selection (if multiple available)
   
2. Display Settings
   - Theme selection (kids/basic themes)
   - Font size (normal, large, extra-large)
   
3. Data Management
   - Export progress (download JSON file)
   - Import progress (upload JSON file)
   - Reset all progress (with confirmation dialog)

DELIVERABLES:
â–¡ svelte/src/routes/asetukset/+page.svelte
â–¡ Settings store (or extend existing stores)
â–¡ Export function (JSON download)
â–¡ Import function (file upload + validation)
â–¡ Reset function with confirmation modal

ESTIMATED TIME: 4-5 hours


================================================================================
PRIORITY 3: VOCABULARY STATISTICS UI (Tasks 7-8)
================================================================================


================================================================================
TASK 7: Create Vocabulary Statistics Page
================================================================================

DESCRIPTION:
Create a dedicated vocabulary statistics page (/sanasto) that shows the user
their learning progress. Display top 1000 progress, estimated CEFR level,
words per category, and learning history. This is where users see the value
of the frequency data.

OBJECTIVES:
â€¢ Create /sanasto route
â€¢ Show total words learned
â€¢ Show top 100/500/1000/3000 progress bars
â€¢ Show estimated CEFR level
â€¢ Show words learned by category
â€¢ Show learning velocity (words per week)
â€¢ Show next milestone ("Learn 30 more words to reach...")

UI COMPONENTS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Sanastosi                       â”‚
â”‚                                      â”‚
â”‚  Opittuja sanoja: 847               â”‚
â”‚  Arvioitu taso: A2                  â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                      â”‚
â”‚  Top 100:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 87%  â”‚
â”‚  Top 500:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 52%   â”‚
â”‚  Top 1000: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 23%   â”‚
â”‚  Top 3000: â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  8%   â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                      â”‚
â”‚  Seuraava tavoite: Top 500          â”‚
â”‚  VielÃ¤ 48 sanaa!                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DELIVERABLES:
â–¡ svelte/src/routes/sanasto/+page.svelte
â–¡ Progress bar components (use DaisyUI progress)
â–¡ Statistics calculation integration
â–¡ Milestone display
â–¡ Category breakdown (optional)

ESTIMATED TIME: 4-5 hours


================================================================================
TASK 8: Add Progress Widget to Home Page
================================================================================

DESCRIPTION:
Add a compact vocabulary progress widget to the home page. Show quick stats
and link to full statistics page. Motivate users with progress visualization.

OBJECTIVES:
â€¢ Create VocabularyProgressWidget.svelte component
â€¢ Show: total words, estimated level, top 1000 progress
â€¢ "NÃ¤ytÃ¤ lisÃ¤Ã¤" link to /sanasto
â€¢ Fits with existing home page layout
â€¢ Loads async (doesn't slow down home page)

WIDGET DESIGN:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Edistymisesi                     â”‚
â”‚                                      â”‚
â”‚  847 sanaa opittu â€¢ Taso: A2        â”‚
â”‚  Top 1000: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 23%           â”‚
â”‚                                      â”‚
â”‚  [NÃ¤ytÃ¤ lisÃ¤Ã¤ â†’]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DELIVERABLES:
â–¡ svelte/src/lib/components/shared/VocabularyProgressWidget.svelte
â–¡ Integration with home page (+page.svelte)
â–¡ Async loading (don't block page render)
â–¡ Link to full statistics page

ESTIMATED TIME: 3-4 hours


================================================================================
PRIORITY 4: STORY MODE FOUNDATION (Tasks 9-12)
================================================================================


================================================================================
TASK 9: Restructure Story Files with Simple Manifest
================================================================================

DESCRIPTION:
Split the single stories.json into individual files per story, organized by
CEFR level. Create a lightweight manifest for listing stories without loading
full content. Keep it simple - no complex caching, just lazy loading.

OBJECTIVES:
â€¢ Create directory structure: static/stories/{a1,a2,b1}/
â€¢ Create stories/manifest.json with story metadata only
â€¢ Move each story to individual JSON file
â€¢ Update storyLoader.ts for new structure
â€¢ Lazy load stories on demand

NEW STRUCTURE:
svelte/static/stories/
â”œâ”€â”€ manifest.json           <- List of all stories (metadata only)
â”œâ”€â”€ a1/
â”‚   â”œâ”€â”€ meeting.json
â”‚   â”œâ”€â”€ colors.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ a2/
â”‚   â”œâ”€â”€ cafe.json
â”‚   â”œâ”€â”€ restaurant.json
â”‚   â””â”€â”€ ...
â””â”€â”€ b1/
    â”œâ”€â”€ climate.json
    â””â”€â”€ ...

MANIFEST FORMAT (lightweight):
{
  "version": "1.0.0",
  "stories": [
    {
      "id": "cafe",
      "title": "Kahvilassa",
      "titleSpanish": "En la cafeterÃ­a",
      "level": "A2",
      "category": "food",
      "icon": "â˜•",
      "wordCount": 120,
      "estimatedMinutes": 3
    },
    ...
  ]
}

DELIVERABLES:
â–¡ New directory structure with story files
â–¡ stories/manifest.json
â–¡ Updated storyLoader.ts with lazy loading
â–¡ Migration script for existing stories
â–¡ Backward compatibility (old stories still work)

ESTIMATED TIME: 5-6 hours


================================================================================
TASK 10: Update Story Types for V4 Data Model
================================================================================

DESCRIPTION:
Update story TypeScript interfaces to include CEFR levels, vocabulary metadata,
and frequency information. Keep backward compatible - new fields are optional.

OBJECTIVES:
â€¢ Update Story interface with CEFR level field
â€¢ Add frequency/CEFR data to VocabularyWord
â€¢ Add partOfSpeech and gender to story vocabulary
â€¢ Map old difficulty to CEFR (beginnerâ†’A2, intermediateâ†’B1)
â€¢ Update story.ts types file

UPDATED INTERFACES:
interface Story {
  // Existing
  id: string;
  title: string;
  titleSpanish: string;
  description: string;
  category: string;
  icon: string;
  dialogue: DialogueLine[];
  vocabulary: VocabularyWord[];
  questions: StoryQuestion[];
  
  // NEW
  level: "A1" | "A2" | "B1" | "B2";  // Replaces difficulty
  wordCount?: number;
  estimatedMinutes?: number;
  
  // DEPRECATED (keep for migration)
  difficulty?: "beginner" | "intermediate" | "advanced";
}

interface VocabularyWord {
  // Existing
  spanish: string;
  finnish: string;
  example?: string;
  
  // NEW
  english?: string;
  partOfSpeech?: string;
  gender?: string;
  frequencyRank?: number;
  cefrLevel?: string;
}

DELIVERABLES:
â–¡ Updated svelte/src/lib/types/story.ts
â–¡ Migration utility for old difficulty â†’ level
â–¡ Type guards for backward compatibility
â–¡ Documentation in code comments

ESTIMATED TIME: 3-4 hours


================================================================================
TASK 11: Migrate and Enhance Existing Stories
================================================================================

DESCRIPTION:
Convert existing 8 stories to V4 format. Add CEFR levels, enhance vocabulary
with frequency data, move to new file structure. Test that everything works.

OBJECTIVES:
â€¢ Migrate 8 existing stories to individual files
â€¢ Map difficulty to CEFR level
â€¢ Add frequency data to story vocabulary
â€¢ Add part of speech and gender where missing
â€¢ Calculate wordCount and estimatedMinutes
â€¢ Verify TTS still works
â€¢ Update manifest with new stories

MIGRATION MAPPING:
- "beginner" â†’ "A2"
- "intermediate" â†’ "B1"
- "advanced" â†’ "B1"

EXISTING STORIES:
1. cafe (coffee shop)
2. market (fruit market)
3. restaurant
4. hotel
5. train (train station)
6. beach
7. park
8. museum

DELIVERABLES:
â–¡ 8 migrated story JSON files in new locations
â–¡ Updated manifest.json
â–¡ Vocabulary enhanced with frequency data
â–¡ All stories tested and working
â–¡ Backup of old stories.json

ESTIMATED TIME: 4-5 hours


================================================================================
TASK 12: Create Mobile-First Story Reader
================================================================================

DESCRIPTION:
Refactor StoryReader for mobile-first design. Stacked layout for translations,
better touch targets, reading progress indicator. Keep existing functionality
working.

OBJECTIVES:
â€¢ Stacked translation layout (Spanish above, Finnish below)
â€¢ Expandable/collapsible translations
â€¢ Reading progress indicator
â€¢ Better touch targets (44px minimum)
â€¢ Auto-hiding controls during reading
â€¢ Responsive design for tablet/desktop

MOBILE LAYOUT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Kahvilassa         3/8 â–‘â–‘â–‘â–ˆâ–‘â–‘â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚
â”‚  MarÃ­a: Buenos dÃ­as, seÃ±ora.    â”‚
â”‚  â–¼ NÃ¤ytÃ¤ kÃ¤Ã¤nnÃ¶s                â”‚
â”‚                                  â”‚
â”‚  Vendedor: Â¡Buenos dÃ­as!        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â”‚  MyyjÃ¤: HyvÃ¤Ã¤ huomenta!         â”‚
â”‚  â–² Piilota                       â”‚
â”‚                                  â”‚
â”‚  MarÃ­a: Â¿CuÃ¡nto cuesta el cafÃ©? â”‚
â”‚  â–¼ NÃ¤ytÃ¤ kÃ¤Ã¤nnÃ¶s                â”‚
â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  [ğŸ”Š]            [Sanasto] [â†’]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DELIVERABLES:
â–¡ Refactored StoryReader.svelte
â–¡ New DialogueLine.svelte with expandable translation
â–¡ Reading progress bar
â–¡ Auto-hiding bottom controls
â–¡ Touch-friendly button sizes

ESTIMATED TIME: 5-6 hours


================================================================================
PRIORITY 5: CONTENT EXPANSION (Tasks 13-14)
================================================================================


================================================================================
TASK 13: Process V4_material.txt into New Stories
================================================================================

DESCRIPTION:
Convert the story content from V4_material.txt into properly structured JSON
files. Generate Finnish translations, extract vocabulary, create questions.
Target: 20+ new stories across A1, A2, B1 levels.

OBJECTIVES:
â€¢ Parse V4_material.txt content
â€¢ Create A1 stories (6-8 lines, simple present tense)
â€¢ Create A2 stories (8-12 lines, past/future)
â€¢ Create B1 stories (10-14 lines, complex grammar)
â€¢ Generate Finnish translations (Azure/OpenAI API)
â€¢ Extract vocabulary with frequency data
â€¢ Create 4-5 questions per story

STORY DISTRIBUTION:
- A1: 8-10 stories (absolute beginner)
- A2: 8-10 stories (beginner)
- B1: 6-8 stories (intermediate)

DELIVERABLES:
â–¡ Translation script (enhance existing scripts/)
â–¡ 20+ new story JSON files
â–¡ Updated manifest.json
â–¡ Vocabulary extracted and enriched
â–¡ Questions for each story

ESTIMATED TIME: 6-7 hours (batch processing)


================================================================================
TASK 14: Create Story Vocabulary Linking
================================================================================

DESCRIPTION:
Create a system to link story vocabulary to the main word database. When user
reads a story, track which words they've encountered. Show "you've seen this
word in X stories" in vocabulary displays.

OBJECTIVES:
â€¢ Create word-to-story index
â€¢ Track vocabulary encounters in stories
â€¢ Link story vocabulary to main words.ts
â€¢ Update wordKnowledge when reading stories
â€¢ Show encounter count in vocabulary displays

SIMPLE INDEX FORMAT:
{
  "wordToStories": {
    "hola": ["meeting", "cafe", "restaurant"],
    "gracias": ["cafe", "hotel", "restaurant"]
  }
}

TRACKING:
- When user reads story, mark vocabulary as "encountered"
- Increment encounter count per word
- Store in localStorage with wordKnowledge data

DELIVERABLES:
â–¡ Story vocabulary index (generated at build time)
â–¡ Encounter tracking in storyProgress
â–¡ Integration with wordKnowledge store
â–¡ "Seen in X stories" display in vocabulary

ESTIMATED TIME: 4-5 hours


================================================================================
PRIORITY 6: PROGRESS SHARING (Tasks 15-16)
================================================================================


================================================================================
TASK 15: Create Shareable Progress Reports
================================================================================

DESCRIPTION:
Create a feature that generates a shareable summary of user's progress.
User can copy text to clipboard for WhatsApp/email, or share via Web Share API
on mobile. Fun way to boast about learning!

OBJECTIVES:
â€¢ Generate text summary of progress
â€¢ Include: words learned, level, top 1000 progress, streak
â€¢ Copy to clipboard button
â€¢ Web Share API for mobile
â€¢ Celebratory UI for milestones

SHARE TEXT EXAMPLE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‰ Espanjapeli - Edistymiseni      â”‚
â”‚                                      â”‚
â”‚  ğŸ“š 847 sanaa opittu                â”‚
â”‚  ğŸ¯ Taso: A2                         â”‚
â”‚  ğŸ”¥ Top 1000: 23% (230/1000)        â”‚
â”‚  ğŸ“– 12 tarinaa luettu               â”‚
â”‚  â­ 14 pÃ¤ivÃ¤n putkeen!              â”‚
â”‚                                      â”‚
â”‚  Opiskelen espanjaa EspanjapelillÃ¤! â”‚
â”‚  https://espanjapeli.fi             â”‚
â”‚                                      â”‚
â”‚  [ğŸ“‹ Kopioi] [ğŸ“¤ Jaa]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DELIVERABLES:
â–¡ Progress report generation function
â–¡ Share modal/page UI
â–¡ Copy to clipboard functionality
â–¡ Web Share API integration (with fallback)
â–¡ Celebration animation for milestones

ESTIMATED TIME: 4-5 hours


================================================================================
TASK 16: Add Milestone Celebrations
================================================================================

DESCRIPTION:
Celebrate when user reaches milestones (100 words, 500 words, top 100 complete,
etc.). Show celebratory modal with confetti, allow sharing. Motivational!

OBJECTIVES:
â€¢ Define milestones (100, 250, 500, 1000 words, etc.)
â€¢ Detect when milestone reached
â€¢ Show celebration modal
â€¢ Confetti animation (CSS or simple library)
â€¢ Option to share achievement
â€¢ Store achieved milestones to avoid re-triggering

MILESTONES:
- ğŸŒ± 100 sanaa opittu
- ğŸŒ¿ 250 sanaa opittu  
- ğŸŒ³ 500 sanaa opittu
- ğŸ¯ Top 100 tÃ¤ysi (100/100)
- ğŸ† Top 500 tÃ¤ysi (500/500)
- ğŸ‘‘ Top 1000 tÃ¤ysi (1000/1000)
- ğŸ“š 5 tarinaa luettu
- ğŸ“– 10 tarinaa luettu

DELIVERABLES:
â–¡ Milestone definition and tracking
â–¡ Celebration modal component
â–¡ Simple confetti animation
â–¡ Integration with progress tracking
â–¡ Share integration

ESTIMATED TIME: 4-5 hours


================================================================================
PRIORITY 7: POLISH AND TESTING (Tasks 17-18)
================================================================================


================================================================================
TASK 17: Improve Game Mode Integration with Frequency Data
================================================================================

DESCRIPTION:
Update existing game modes (YhdistÃ¤ sanat, etc.) to use frequency data.
Prioritize high-frequency words for learning. Show frequency badges on words.
Make games smarter about word selection.

OBJECTIVES:
â€¢ Show word frequency/CEFR level in games
â€¢ Prioritize top 1000 words for beginners
â€¢ Track which top-N words are practiced
â€¢ Add "focus on top 1000" mode option
â€¢ Show progress toward frequency goals

ENHANCEMENTS:
- Word cards show small badge: "A1" or "Top 500"
- Word selection prefers high-frequency unknowns
- Settings: "Focus on most common words" toggle
- After game: "You practiced 5 of top 1000 words"

DELIVERABLES:
â–¡ Frequency badges in game UI
â–¡ Smart word selection algorithm
â–¡ Settings for frequency focus
â–¡ Post-game frequency summary
â–¡ Integration with statisticsService

ESTIMATED TIME: 4-5 hours


================================================================================
TASK 18: Testing and Documentation
================================================================================

DESCRIPTION:
Test all V4 features across devices and browsers. Fix bugs. Update documentation.
Prepare for release.

OBJECTIVES:
â€¢ Test on mobile (iOS Safari, Android Chrome)
â€¢ Test on desktop browsers
â€¢ Test localStorage persistence
â€¢ Test data import/export
â€¢ Fix all critical bugs
â€¢ Update user documentation
â€¢ Write release notes

TESTING CHECKLIST:
â–¡ Vocabulary statistics calculate correctly
â–¡ Frequency data loads properly
â–¡ Stories load lazily
â–¡ Progress persists in localStorage
â–¡ Export/import works
â–¡ Share functionality works on mobile
â–¡ Navigation works on all pages
â–¡ License page displays correctly
â–¡ All games still work

DELIVERABLES:
â–¡ Bug fixes for issues found
â–¡ Updated README.md
â–¡ Release notes for V4.0.0
â–¡ Testing report

ESTIMATED TIME: 5-6 hours


================================================================================
SUMMARY
================================================================================

Total Tasks: 18
Estimated Total Time: 75-90 hours (approximately 8 weeks)
Average Task Size: 4-5 hours

TASK CATEGORIES:
â€¢ Data Foundation (Tasks 1-4): ~15-19 hours - CRITICAL, DO FIRST
â€¢ Navigation & Structure (Tasks 5-6): ~8-10 hours
â€¢ Vocabulary Statistics UI (Tasks 7-8): ~7-9 hours
â€¢ Story Mode Foundation (Tasks 9-12): ~17-21 hours
â€¢ Content Expansion (Tasks 13-14): ~10-12 hours
â€¢ Progress Sharing (Tasks 15-16): ~8-10 hours
â€¢ Polish & Testing (Tasks 17-18): ~9-11 hours

DEPENDENCIES:
â€¢ Tasks 1-4 MUST complete before all other tasks
â€¢ Task 1 â†’ Task 2 â†’ Task 3 (sequential)
â€¢ Task 4 can run parallel with Tasks 2-3
â€¢ Task 5 â†’ Task 6 (sequential)
â€¢ Tasks 5-6 can start after Task 4
â€¢ Tasks 7-8 depend on Task 3
â€¢ Tasks 9-12 depend on Task 2
â€¢ Tasks 13-14 depend on Task 11
â€¢ Tasks 15-16 depend on Task 7
â€¢ Task 17 depends on Tasks 3 and 12
â€¢ Task 18 is last

PRIORITY ORDER:
1. Foundation (Tasks 1-4): Data model and vocabulary
2. Navigation (Tasks 5-6): App structure
3. Statistics (Tasks 7-8): User-facing vocabulary progress
4. Stories (Tasks 9-12): Reading mode improvements
5. Content (Tasks 13-14): New story content
6. Sharing (Tasks 15-16): Social/motivation features
7. Polish (Tasks 17-18): Integration and testing

KEY PRINCIPLES (from PRINCIPLES.md):
â€¢ Simple is better - avoid over-engineering
â€¢ One-developer maintainable - keep it simple
â€¢ Frontend only - all data as static JSON
â€¢ Mobile-first - but works on all devices
â€¢ LocalStorage for progress - no backend
â€¢ Open source data - proper licensing

DATA FILES OVERVIEW:
svelte/static/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ frequency-spanish.json     (50k words, ~500KB)
â”‚   â”œâ”€â”€ frequency-finnish.json     (50k words, ~500KB)
â”‚   â””â”€â”€ licenses.json              (data source attributions)
â”œâ”€â”€ stories/
â”‚   â”œâ”€â”€ manifest.json              (story list, ~10KB)
â”‚   â”œâ”€â”€ vocabulary-index.json      (wordâ†’story mapping, ~50KB)
â”‚   â”œâ”€â”€ a1/                        (A1 level stories)
â”‚   â”œâ”€â”€ a2/                        (A2 level stories)
â”‚   â””â”€â”€ b1/                        (B1 level stories)
â””â”€â”€ ...

LOCALSTORAGE KEYS:
- yhdistasanat_word_knowledge: existing game progress
- espanjapeli_settings: user preferences
- espanjapeli_story_progress: story reading progress
- espanjapeli_milestones: achieved milestones

================================================================================
END OF V4 TODO LIST
================================================================================

Created: January 12, 2026
Based on: V4_ROADMAP.md, V4_DATAMODEL_IDEAS_improved.md, PRINCIPLES.md
Target Release: V4.0.0 - Data-First Architecture + Story Mode Excellence
